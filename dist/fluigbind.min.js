!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).fluigbind=e()}(this,function(){"use strict";var r=["prefix","templateDelimiters","rootInterface","preloadData","handler"],o=["binders","formatters","adapters"],i=/^'.*'$|^".*"$/;function n(t){var e=0,n=t;return i.test(t)?n=t.slice(1,-1):"true"===t?n=!0:"false"===t?n=!1:"null"===t?n=null:"undefined"===t?n=void 0:isNaN(t)?e=1:n=Number(t),{type:e,value:n}}function c(t,e){for(var n,i,r=t.length,o=0,a=e[0],s=e[1];o<r;){if((i=t.indexOf(a,o))<0){n&&n.push({type:0,value:t.slice(o)});break}if(n=n||[],0<i&&o<i&&n.push({type:0,value:t.slice(o,i)}),o=i+a.length,(i=t.indexOf(s,o))<0){var c=t.slice(o-s.length),l=n[n.length-1];l&&0===l.type?l.value+=c:n.push({type:0,value:c});break}l=t.slice(o,i).trim();n.push({type:1,value:l}),o=i+s.length}return n}function E(){E=function(){return a};var a={},t=Object.prototype,c=t.hasOwnProperty,l=Object.defineProperty||function(t,e,n){t[e]=n.value},e="function"==typeof Symbol?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",r=e.toStringTag||"@@toStringTag";function o(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{o({},"")}catch(t){o=function(t,e,n){return t[e]=n}}function s(t,e,n,i){var r,o,a,s,e=e&&e.prototype instanceof f?e:f,e=Object.create(e.prototype),i=new w(i||[]);return l(e,"_invoke",{value:(r=t,o=n,a=i,s="suspendedStart",function(t,e){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===t)throw e;return O()}for(a.method=t,a.arg=e;;){var n=a.delegate;if(n){n=function t(e,n){var i=n.method,r=e.iterator[i];if(void 0===r)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=void 0,t(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),h;i=u(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,h;r=i.arg;return r?r.done?(n[e.resultName]=r.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=void 0),n.delegate=null,h):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}(n,a);if(n){if(n===h)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";n=u(r,o,a);if("normal"===n.type){if(s=a.done?"completed":"suspendedYield",n.arg===h)continue;return{value:n.arg,done:a.done}}"throw"===n.type&&(s="completed",a.method="throw",a.arg=n.arg)}})}),e}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}a.wrap=s;var h={};function f(){}function d(){}function p(){}var e={},v=(o(e,i,function(){return this}),Object.getPrototypeOf),v=v&&v(v(_([]))),b=(v&&v!==t&&c.call(v,i)&&(e=v),p.prototype=f.prototype=Object.create(e));function m(t){["next","throw","return"].forEach(function(e){o(t,e,function(t){return this._invoke(e,t)})})}function g(a,s){var e;l(this,"_invoke",{value:function(n,i){function t(){return new s(function(t,e){!function e(t,n,i,r){var o,t=u(a[t],a,n);if("throw"!==t.type)return(n=(o=t.arg).value)&&"object"==typeof n&&c.call(n,"__await")?s.resolve(n.__await).then(function(t){e("next",t,i,r)},function(t){e("throw",t,i,r)}):s.resolve(n).then(function(t){o.value=t,i(o)},function(t){return e("throw",t,i,r)});r(t.arg)}(n,i,t,e)})}return e=e?e.then(t,t):t()}})}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function _(e){if(e){var n,t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return n=-1,(t=function t(){for(;++n<e.length;)if(c.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t}).next=t}return{next:O}}function O(){return{value:void 0,done:!0}}return l(b,"constructor",{value:d.prototype=p,configurable:!0}),l(p,"constructor",{value:d,configurable:!0}),d.displayName=o(p,r,"GeneratorFunction"),a.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,o(t,r,"GeneratorFunction")),t.prototype=Object.create(b),t},a.awrap=function(t){return{__await:t}},m(g.prototype),o(g.prototype,n,function(){return this}),a.AsyncIterator=g,a.async=function(t,e,n,i,r){void 0===r&&(r=Promise);var o=new g(s(t,e,n,i),r);return a.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},m(b),o(b,r,"Generator"),o(b,i,function(){return this}),o(b,"toString",function(){return"[object Generator]"}),a.keys=function(t){var e,n=Object(t),i=[];for(e in n)i.push(e);return i.reverse(),function t(){for(;i.length;){var e=i.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},a.values=_,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&c.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var i=this;function t(t,e){return o.type="throw",o.arg=n,i.next=t,e&&(i.method="next",i.arg=void 0),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var a=c.call(r,"catchLoc"),s=c.call(r,"finallyLoc");if(a&&s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r.finallyLoc,h):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),h}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n,i,r=this.tryEntries[e];if(r.tryLoc===t)return"throw"===(n=r.completion).type&&(i=n.arg,k(r)),i}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:_(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},a}function l(t,e,n,i,r,o,a){try{var s=t[o](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,r)}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}(i.key),i)}}function s(t,e,n){e&&a(t.prototype,e),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1})}function u(t,e){t.prototype=Object.create(e.prototype),f(t.prototype.constructor=t,e)}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e,n){return(d=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(t){}}}()?Reflect.construct.bind():function(t,e,n){var i=[null];i.push.apply(i,e);e=new(Function.bind.apply(t,i));return n&&f(e,n.prototype),e}).apply(null,arguments)}function t(t){var n="function"==typeof Map?new Map:void 0;return function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return d(t,arguments,h(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),f(e,t)}(t)}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var v,b,m,e=function(){function t(t){this.datasetName=t}return t.prototype.load=function(){s=E().mark(function t(){var n,i,e;return E().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.datasetName){t.next=3;break}throw new Error("No dataset declared for "+this.name);case 3:return n=[],(i=this.constraints)&&Object.keys(i).forEach(function(t){var e=i[t];n.push(t),n.push(e)}),t.next=8,[];case 8:return e=t.sent,t.abrupt("return",e);case 10:case"end":return t.stop()}},t,this)});var s,t=function(){var t=this,a=arguments;return new Promise(function(e,n){var i=s.apply(t,a);function r(t){l(i,e,n,r,o,"next",t)}function o(t){l(i,e,n,r,o,"throw",t)}r(void 0)})};return function(){return t.apply(this,arguments)}}(),t}(),g=function(){function e(t,e){this.label=t,this.type=e}var t=e.prototype;return t.init=function(){},t.load=function(){},t.reset=function(){},t.change=function(){},t.validate=function(){},t.destroy=function(){},t.clone=function(){var t=Object.assign({},this);return Object.setPrototypeOf(t,e.prototype)},s(e,[{key:"data",get:function(){return this._data},set:function(t){this._data=t}},{key:"value",get:function(){return this._value},set:function(t){this._value=t}},{key:"visible",get:function(){return this._visible},set:function(t){this._visible=t}},{key:"mandatory",get:function(){return this._mandatory},set:function(t){this._mandatory=t}},{key:"dataset",get:function(){return this._dataset},set:function(t){this._dataset=t}}]),e}(),y=function(){function t(t){this.name=t}var e=t.prototype;return e.init=function(){},e.load=function(){},e.reset=function(){},e.change=function(){},e.validate=function(){},e.destroy=function(){},s(t,[{key:"visible",get:function(){return this._visible},set:function(t){this._visible=t}},{key:"title",get:function(){return this._title},set:function(t){this._title=t}},{key:"fields",get:function(){return this._fields},set:function(t){this._fields=t}}]),t}(),k=function(){function t(t){this.tablename=t}var e=t.prototype;return e.init=function(){},e.load=function(){},e.reset=function(){},e.validate=function(){},e.add=function(){},e.remove=function(){},s(t,[{key:"fields",get:function(){return this._fields},set:function(t){this._fields=t}},{key:"children",get:function(){return this._children},set:function(t){this._children=t}}]),t}(),w={State:function(){function t(t,e){this.id=t,this.name=e}var e=t.prototype;return e.init=function(){},e.load=function(){},t}(),Field:g,Dataset:e,Section:y,Table:k,binders:{},formatters:{},adapters:{},_prefix:"flg",_fullPrefix:"flg-",defaults:{locale:"pt-BR",currency:"BRL"},get prefix(){return this._prefix},set prefix(t){this._prefix=t,this._fullPrefix=t+"-"},parseTemplate:c,parseType:n,templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,handler:function(t,e,n){this.call(t,e,n.view.models)},fallbackBinder:function(t,e){null!=e?t.setAttribute(this.type,e):t.removeAttribute(this.type)},configure:function(t){var i=this;t&&Object.keys(t).forEach(function(e){var n=t[e];-1<o.indexOf(e)?Object.keys(n).forEach(function(t){i[e][t]=n[t]}):i[e]=n})}};function _(t){return"object"==typeof t&&null!==t}var O=function(){function n(t,e,n){this.keypath=e,this.callback=n,this.objectPath=[],this.parse(),this.obj=this.getRootObject(t),_(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}n.updateOptions=function(t){v=t.adapters,b=Object.keys(v),m=t.rootInterface},n.tokenize=function(t,e){for(var n,i=[],r={i:e,path:""},o=0;o<t.length;o++)n=t.charAt(o),~b.indexOf(n)?(i.push(r),r={i:n,path:""}):r.path+=n;return i.push(r),i};var t=n.prototype;return t.parse=function(){var t,e;if(!b.length)throw new Error("[Observer] "+"Must define at least one adapter interface.");t=~b.indexOf(this.keypath[0])?(e=this.keypath[0],this.keypath.substr(1)):(e=m,this.keypath),this.tokens=n.tokenize(t,e),this.key=this.tokens.pop()},t.realize=function(){for(var t,e,n=this.obj,i=-1,r=0;r<this.tokens.length;r++)e=this.tokens[r],_(n)?(void 0!==this.objectPath[r]?n!==(t=this.objectPath[r])&&(this.set(!1,e,t,this),this.set(!0,e,n,this),this.objectPath[r]=n):(this.set(!0,e,n,this),this.objectPath[r]=n),n=this.get(e,n)):(-1===i&&(i=r),(t=this.objectPath[r])&&this.set(!1,e,t,this));return-1!==i&&this.objectPath.splice(i),n},t.sync=function(){var t,e,n;(t=this.realize())!==this.target?(_(this.target)&&this.set(!1,this.key,this.target,this.callback),_(t)&&this.set(!0,this.key,t,this.callback),e=this.value(),this.target=t,((n=this.value())!==e||n instanceof Function)&&this.callback.sync()):t instanceof Array&&this.callback.sync()},t.value=function(){if(_(this.target))return this.get(this.key,this.target)},t.setValue=function(t){_(this.target)&&v[this.key.i].set(this.target,this.key.path,t)},t.get=function(t,e){return v[t.i].get(e,t.path)},t.set=function(t,e,n,i){v[e.i][t?"observe":"unobserve"](n,e.path,i)},t.unobserve=function(){for(var t,e,n=0;n<this.tokens.length;n++)e=this.tokens[n],(t=this.objectPath[n])&&this.set(!1,e,t,this);_(this.target)&&this.set(!1,this.key,this.target,this.callback)},t.getRootObject=function(t){var e,n;if(!t.$parent)return t;for(e=(this.tokens.length?this.tokens[0]:this.key).path,n=t;n.$parent&&void 0===n[e];)n=n.$parent;return n},n}();function x(t,e){var n=!1;if(3===e.nodeType){var i=c(e.data,w.templateDelimiters);if(i){for(var r=0;r<i.length;r++){var o=i[r],a=document.createTextNode(o.value);e.parentNode.insertBefore(a,e),1===o.type&&t.buildBinding(a,null,o.value,R,null)}e.parentNode.removeChild(e)}n=!0}else 1===e.nodeType&&(n=t.traverse(e));if(!n)for(var s=0;s<e.childNodes.length;s++)x(t,e.childNodes[s])}function j(t,e){return t=t.binder&&t.binder.priority||0,(e.binder&&e.binder.priority||0)-t}function L(t){return t.trim()}function N(t){return null!=t?t.toString():void 0}var P=/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g,A=/\s+/,T=function(){function t(t,e,n,i,r,o,a){this.view=t,this.el=e,this.type=n,this.keypath=i,this.binder=r,this.arg=o,this.formatters=a,this.formatterObservers={},this.model=void 0}var e=t.prototype;return e.observe=function(t,e){return new O(t,e,this)},e.parseTarget=function(){var t;this.keypath?0===(t=n(this.keypath)).type?this.value=t.value:(this.observer=this.observe(this.view.models,this.keypath),this.model=this.observer.target):this.value=void 0},e.parseFormatterArguments=function(t,i){var r=this;return t.map(n).map(function(t,e){var n=t.type,t=t.value;return 0===n?t:(r.formatterObservers[i]||(r.formatterObservers[i]={}),(n=r.formatterObservers[i][e])||(n=r.observe(r.view.models,t),r.formatterObservers[i][e]=n),n.value())})},e.formattedValue=function(t){var r=this;return this.formatters.reduce(function(t,e,n){var e=e.match(P),i=e.shift(),i=r.view.options.formatters[i],e=r.parseFormatterArguments(e,n);return i&&i.read instanceof Function?t=i.read.apply(i,[t].concat(e)):i instanceof Function&&(t=i.apply(void 0,[t].concat(e))),t},t)},e.eventHandler=function(e){var n=this,i=n.view.options.handler;return function(t){i.call(e,this,t,n)}},e.set=function(t){t=t instanceof Function&&!this.binder.function?this.formattedValue(t.call(this.model)):this.formattedValue(t);var e=this.binder.routine||this.binder;e instanceof Function&&e.call(this,this.el,t)},e.sync=function(){this.observer?(this.model=this.observer.target,this.set(this.observer.value())):this.set(this.value)},e.publish=function(){var t,r=this;this.observer&&(t=this.formatters.reduceRight(function(t,e,n){var e=e.split(A),i=e.shift(),i=r.view.options.formatters[i],e=r.parseFormatterArguments(e,n);return t=i&&i.publish?i.publish.apply(i,[t].concat(e)):t},this.getValue(this.el)),this.observer.setValue(t))},e.bind=function(){this.parseTarget(),this.binder.hasOwnProperty("bind")&&this.binder.bind.call(this,this.el),this.view.options.preloadData&&this.sync()},e.unbind=function(){var n=this;this.binder.unbind&&this.binder.unbind.call(this,this.el),this.observer&&this.observer.unobserve(),Object.keys(this.formatterObservers).forEach(function(t){var e=n.formatterObservers[t];Object.keys(e).forEach(function(t){e[t].unobserve()})}),this.formatterObservers={}},e.update=function(t){void 0===t&&(t={}),this.observer&&(this.model=this.observer.target),this.binder.update&&this.binder.update.call(this,t)},e.getValue=function(t){if(this.binder&&this.binder.getValue)return this.binder.getValue.call(this,t);var e=t;if("checkbox"===e.type)return e.checked;if("select-multiple"!==e.type)return e.value;for(var n,i=[],r=0;r<e.options.length;r++)(n=e.options[r]).selected&&i.push(n.value);return i},t}(),R={routine:function(t,e){t.data=null!=e?e:""}},S=/((?:'[^']*')*(?:(?:[^\|']*(?:'[^']*')+[^\|']*)+|[^\|]+))|^$/g,C=function(){function t(t,e,n){t.jquery||t instanceof Array?this.els=t:this.els=[t],this.models=e,this.options=n,this.build()}var e=t.prototype;return e.buildBinding=function(t,e,n,i,r){var n=n.match(S).map(L),o=n.shift();this.bindings.push(new T(this,t,e,o,i,r,n))},e.build=function(){this.bindings=[];for(var t=this.els,e=0,n=t.length;e<n;e++)x(this,t[e]);this.bindings.sort(j)},e.traverse=function(t){for(var e,n,i,r,o=w._fullPrefix,a="SCRIPT"===t.nodeName||"STYLE"===t.nodeName,s=t.attributes,c=[],l=this.options.starBinders,u=0,h=s.length;u<h;u++){var f=s[u];if(0===f.name.indexOf(o)){if(e=f.name.slice(o.length),r=void 0,!(n=this.options.binders[e]))for(var d=0;d<l.length;d++)if(i=l[d],e.slice(0,i.length-1)===i.slice(0,-1)){n=this.options.binders[i],r=e.slice(i.length-1);break}if((n=n||w.fallbackBinder).block)return this.buildBinding(t,e,f.value,n,r),t.removeAttribute(f.name),!0;c.push({attr:f,binder:n,type:e,arg:r})}}for(var p=0;p<c.length;p++){var v=c[p];this.buildBinding(t,v.type,v.attr.value,v.binder,v.arg),t.removeAttribute(v.attr.name)}return a},e.bind=function(){this.bindings.forEach(function(t){t.bind()})},e.unbind=function(){this.bindings.forEach(function(t){t.unbind()})},e.sync=function(){this.bindings.forEach(function(t){t.sync()})},e.publish=function(){this.bindings.forEach(function(t){t.binder&&t.binder.publishes&&t.publish()})},e.update=function(e){var n=this;void 0===e&&(e={}),Object.keys(e).forEach(function(t){n.models[t]=e[t]}),this.bindings.forEach(function(t){t.update&&t.update(e)})},t}(),D=["push","pop","shift","unshift","sort","reverse","splice"],g={counter:0,weakmap:{},weakReference:function(t){var e;return t.hasOwnProperty("__flg")||(e=this.counter++,Object.defineProperty(t,"__flg",{value:e})),this.weakmap[t.__flg]||(this.weakmap[t.__flg]={callbacks:{}}),this.weakmap[t.__flg]},cleanupWeakReference:function(t,e){Object.keys(t.callbacks).length||t.pointers&&Object.keys(t.pointers).length||delete this.weakmap[e]},stubFunction:function(r,t){var o=r[t],a=this.weakReference(r),s=this.weakmap;r[t]=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=o.apply(r,e);return Object.keys(a.pointers).forEach(function(t){var e=a.pointers[t];s[t]&&s[t].callbacks[e]instanceof Array&&s[t].callbacks[e].forEach(function(t){t.sync()})}),i}},observeArray:function(e,t,n){var i,r=this;e instanceof Array&&((i=this.weakReference(e)).pointers||(i.pointers={},D.forEach(function(t){r.stubFunction(e,t)})),i.pointers[t]||(i.pointers[t]=[]),-1===i.pointers[t].indexOf(n))&&i.pointers[t].push(n)},unobserveArray:function(t,e,n){var i,r;t instanceof Array&&null!=t.__flg&&(i=this.weakmap[t.__flg])&&(r=i.pointers[e])&&(-1<(n=r.indexOf(n))&&r.splice(n,1),r.length||delete i.pointers[e],this.cleanupWeakReference(i,t.__flg))},observe:function(n,i,t){var r,e,o=this,a=this.weakReference(n).callbacks;a[i]||(a[i]=[],(e=Object.getOwnPropertyDescriptor(n,i))&&(e.get||e.set||!e.configurable))||(r=n[i],Object.defineProperty(n,i,{enumerable:!0,get:function(){return r},set:function(t){var e;t!==r&&(o.unobserveArray(r,n.__flg,i),r=t,e=o.weakmap[n.__flg])&&((e=e.callbacks[i])&&e.forEach(function(t){t.sync()}),o.observeArray(t,n.__flg,i))}})),-1===a[i].indexOf(t)&&a[i].push(t),this.observeArray(n[i],n.__rv,i)},unobserve:function(t,e,n){var i,r=this.weakmap[t.__rv];r&&(i=r.callbacks[e])&&(-1<(n=i.indexOf(n))&&(i.splice(n,1),i.length||(delete r.callbacks[e],this.unobserveArray(t[e],t.__flg,e))),this.cleanupWeakReference(r,t.__flg))},get:function(t,e){return t[e]},set:function(t,e,n){t[e]=n}},e={watch:function(t){return t},not:function(t){return!t},json:function(t){return JSON.stringify(t)},number:{read:function(t,e,n,i){return e=e||"decimal",n=n||w.defaults.locale,i=i||w.defaults.currency,new Intl.NumberFormat(n,{style:e,currency:i}).format(t)},publish:function(t){return parseFloat(t.replace(/^\w{0,3}\W?\s?(\d+)[.,](\d+)?,?(\d+)?$/g,function(t,e,n,i){return i?""+e+n+"."+i:e+"."+n}))}}},y=function(t){function e(){return t.apply(this,arguments)||this}u(e,t);var n=e.prototype;return n.connectedCallback=function(){var t=this.constructor.__templateEl.content.cloneNode(!0);for(this.__fluigbindView=w.bind(t,this);this.firstChild;)this.removeChild(this.firstChild);this.appendChild(t)},n.disconnectedCallback=function(){this.__fluigbindView.unbind()},n.attributeChangedCallback=function(t,e,n){e!==n&&(this[this.constructor.__propAttributeMap[t]]=n)},s(e,null,[{key:"observedAttributes",get:function(){var t=this.template;if(!t)throw new Error("No template declared for "+this.name);this.__templateEl=document.createElement("template"),this.__templateEl.innerHTML=t;var n=this.__propAttributeMap={},i=[],r=this.properties;return r&&Object.keys(r).forEach(function(t){var e=r[t],e="string"==typeof e?e:t;n[e]=t,i.push(e)}),i}}]),e}(t(HTMLElement)),B=function(a){return function(t,e){var n=fluigbind.adapters["."],i=a.displaykey,n=n.get(a,"items"),r=[],o=new RegExp(t,"i");n.forEach(function(t){o.test(t[i])&&r.push(t)}),e(r)}};function F(t,e,n){var i=t.el.cloneNode(!0),e=new C(i,e,t.view.options);return e.bind(),t.marker.parentNode.insertBefore(i,n),e}var k={autocomplete:{publishes:!0,bind:function(e){var n=this,t=this.model.data;this.callback=function(t){n.publish(),e.dispatchEvent(new Event("change"))},this.model.autocomplete=FLUIGC.autocomplete(e,{source:B(this.model),maxTags:1,templates:{tag:t.tplSelected||"",suggestion:t.tplList||"",tip:t.tplTip||""},minLength:0,displayKey:t.displaykey,tagClass:t.tagClass||"col-xs-12",type:"tagAutocomplete",tagMaxWidth:800}),this.model.value&&this.model.autocomplete.add(this.model.value),this.model.autocomplete.on("fluig.autocomplete.itemAdded",this.callback),this.model.autocomplete.on("fluig.autocomplete.itemRemoved",this.callback)},routine:function(t,e){var n=this.model.autocomplete.items()[0];if(e!=n){if(n)if(e)this.model.autocomplete.removeAll();else try{this.model.autocomplete.input()[0].parentNode.previousElementSibling.children[0].children[0].style.color="white"}catch(t){}e&&this.model.autocomplete.add(e)}},getValue:function(t){return this.model.autocomplete.items()[0]}},calendar:{bind:function(e){var n=this;this.changeDate=function(t){Date.parse(n.model.value)!==n.model.calendar.getTimestampDate()&&(n.model.value=n.model.calendar.getDate().format("YYYY-MM-DD HH:MM:SS.s"),e.dispatchEvent(new Event("change")))},this.model.calendar=FLUIGC.calendar(e),e.addEventListener("focusout",this.changeDate)},unbind:function(t){t.removeEventListener("focusout",this.changeDate)},routine:function(t,e){e&&(e=Date.parse(e),this.model.calendar.setDate(new Date(e)))}},child:function(t,e){var n=t.name;0<n.indexOf("___")&&(n=n.split("___")[0]),t.name=n+"___"+(e+1)},"on-*":{function:!0,priority:1e3,unbind:function(t){this.handler&&t.removeEventListener(this.arg,this.handler)},routine:function(t,e){this.handler&&t.removeEventListener(this.arg,this.handler),this.handler=this.eventHandler(e),t.addEventListener(this.arg,this.handler)}},"each-*":{block:!0,priority:4e3,bind:function(t){this.marker?this.iterated.forEach(function(t){t.bind()}):(this.marker=document.createComment(" fluigbind: "+this.type+" "),this.iterated=[],t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t))},unbind:function(t){this.iterated&&this.iterated.forEach(function(t){t.unbind()})},routine:function(t,e){var s=this,c=this.arg,l=(e=e||[],t.getAttribute("index-property")||"$index");if(e.forEach(function(t,e){var n={$parent:s.view.models},i=(n[l]=e,n[c]=t,s.iterated[e]);if(i)if(i.models[c]!==t){for(var r,o,a=e+1;a<s.iterated.length;a++)if((o=s.iterated[a]).models[c]===t){r=a;break}void 0!==r?(s.iterated.splice(r,1),s.marker.parentNode.insertBefore(o.els[0],i.els[0]),o.models[l]=e):o=F(s,n,i.els[0]),s.iterated.splice(e,0,o)}else i.models[l]=e;else{e=s.marker;s.iterated.length&&(e=s.iterated[s.iterated.length-1].els[0]),i=F(s,n,e.nextSibling),s.iterated.push(i)}}),this.iterated.length>e.length)for(var n=this.iterated.length-e.length,i=function(){var t=s.iterated.pop();t.unbind(),s.marker.parentNode.removeChild(t.els[0])},r=0;r<n;r++)i();"OPTION"===t.nodeName&&this.view.bindings.forEach(function(t){t.el===s.marker.parentNode&&"value"===t.type&&t.sync()})},update:function(e){var n=this,i={};Object.keys(e).forEach(function(t){t!==n.arg&&(i[t]=e[t])}),this.iterated.forEach(function(t){t.update(i)})}},"class-*":function(t,e){var n=" "+t.className+" ";!e==-1<n.indexOf(" "+this.arg+" ")&&(t.className=e?t.className+" "+this.arg:n.replace(" "+this.arg+" "," ").trim())},text:function(t,e){t.textContent=null!=e?e:""},html:function(t,e){t.innerHTML=null!=e?e:""},show:function(t,e){t.style.display=e?"":"none"},hide:function(t,e){t.style.display=e?"none":""},enabled:function(t,e){t.disabled=!e},disabled:function(t,e){t.disabled=!!e},checked:{publishes:!0,priority:2e3,bind:function(t){var e=this;this.callback||(this.callback=function(){e.publish()}),t.addEventListener("change",this.callback)},unbind:function(t){t.removeEventListener("change",this.callback)},routine:function(t,e){"radio"===t.type?t.checked=N(t.value)===N(e):t.checked=!!e}},value:{publishes:!0,priority:3e3,bind:function(t){var e;this.isRadio="INPUT"===t.tagName&&"radio"===t.type,this.isRadio||(this.event=t.getAttribute("event-name")||("SELECT"===t.tagName?"change":"input"),(e=this).callback||(this.callback=function(){e.publish()}),t.addEventListener(this.event,this.callback))},unbind:function(t){this.isRadio||t.removeEventListener(this.event,this.callback)},routine:function(t,e){if(this.isRadio)t.setAttribute("value",e);else if("select-multiple"===t.type){if(e instanceof Array)for(var n=0;n<t.length;n++){var i=t[n];i.selected=-1<e.indexOf(i.value)}}else N(e)!==N(t.value)&&(t.value=null!=e?e:"")}},if:{block:!0,priority:4e3,bind:function(t){this.marker?!1===this.bound&&this.nested&&this.nested.bind():(this.marker=document.createComment(" fluigbind: "+this.type+" "+this.keypath+" "),this.attached=!1,t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t)),this.bound=!0},unbind:function(){this.nested&&(this.nested.unbind(),this.bound=!1)},routine:function(t,e){!!e!==this.attached&&(e?(this.nested||(this.nested=new C(t,this.view.models,this.view.options),this.nested.bind()),this.marker.parentNode.insertBefore(t,this.marker.nextSibling),this.attached=!0):(t.parentNode.removeChild(t),this.attached=!1))},update:function(t){this.nested&&this.nested.update(t)}}},I={autocomplete:function(n){function t(){var t=n.call(this)||this,e=p(t);return e.model=fields[e.getAttribute("field")],t}return u(t,n),s(t,null,[{key:"template",get:function(){return'\n      <div flg-show="model.visible" flg-class-has-error="model.errors" flg-class-has-warning="model.warnings" class="form-group">\n        <label class="control-label">{model.label}</label>\n        <div flg-show="model.loading" class="fs-skeleton-loader fs-skeleton-loader-input"></div>\n        <input flg-autocomplete="model.value" flg-enabled="model.editable" flg-show="model.loading | !" type="text" rv-class="model.classes" flg-on-change="model.change">\n        <p class="help-block" flg-if="model.errors"><i class="flaticon flaticon-global-error icon-sm" aria-hidden="true"></i>{model.errors}</p>\n        <p class="help-block" flg-if="model.warnings"><i class="flaticon flaticon-alert icon-sm" aria-hidden="true"></i>{model.warnings}</p>\n      </div>\n    '}},{key:"properties",get:function(){return{field:!0}}}]),t}(y),calendar:function(n){function t(){var t=n.call(this)||this,e=p(t);return e.model=fields[e.getAttribute("field")],t}return u(t,n),s(t,null,[{key:"template",get:function(){return'\n    <div flg-class-has-error="model.errors" flg-class-has-warning="model.warnings" class="form-group fs-text-center">\n      <label>Início Previsto</label>\n      <input class="fs-text-center" type="text" flg-enabled="model.editable" flg-on-change="model.change" flg-calendar="model.value" />\n      <p class="help-block" flg-if="model.errors">{model.errors}</p>\n      <p class="help-block" flg-if="model.warnings">{model.warnings}</p>\n    </div>\n    '}},{key:"properties",get:function(){return{field:!0}}}]),t}(y)};return w.Component=y,w.binders=k,w.formatters=e,w.adapters["."]=g,w.components=I,w.bind=function(t,e,n){var i={},t=(e=e||{},n=n||{},o.forEach(function(e){i[e]=Object.create(null),n[e]&&Object.keys(n[e]).forEach(function(t){i[e][t]=n[e][t]}),Object.keys(w[e]).forEach(function(t){i[e][t]||(i[e][t]=w[e][t])})}),r.forEach(function(t){var e=n[t];i[t]=null!=e?e:w[t]}),i.starBinders=Object.keys(i.binders).filter(function(t){return 0<t.indexOf("*")}),O.updateOptions(i),new C(t,e,i));return t.bind(),t},w});
//# sourceMappingURL=fluigbind.min.js.map
